@model IEnumerable<L.R._Gcaleka__Co.Models.Appointment>
@{
    Layout = "_StaffLayout";
}

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales-all.min.js"></script>
<link href="~/css/stafflayout.css" rel="stylesheet" />


<body>
    <div class="main-content">
    <button id="toggleView" class="btn btn-primary">Switch to list</button>

    <div class="calendar" id="calendar"></div>

    <div id="listView" style="display:none;">
        <table class="table">
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Date</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var appointment in Model)
                {
                    <tr>
                        <td>@appointment.LoggedInClient.FirstName @appointment.LoggedInClient.LastName</td>
                        <td>@appointment.AppointmentDate.ToString("dd-MM-yyyy")</td>
                        <td>@appointment.AppointmentType</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
        <a asp-action="Dashboard" asp-controller="Home" class="button">Exit</a>
    </div>
</body>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var calendarEl = document.getElementById('calendar');
        console.log(@Html.Raw(Json.Serialize(Model)));
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            slotMinTime: "00:00:00",
            slotMaxTime: "24:00:00",
            contentHeight: "auto", // Ensure the height adjusts
            aspectRatio: 1.8, // Adjust this if necessary
            dayMaxEventRows: false, // Ensures multiple events display properly
            views: {
                dayGridMonth: {
                    visibleRange: null // Ensure FullCalendar doesn't limit visible days
                }
            },
            events: @Html.Raw(Json.Serialize(Model.Select(a => new
        {
            title = a.LoggedInClient.LastName,
            start = a.AppointmentDate.ToString("yyyy-MM-dd"),
            allDay = true
        })))
            });
        console.log("FullCalendar object:", window.FullCalendar);


        calendar.render();

        setTimeout(() => {
            calendar.updateSize();
        }, 300);

        console.log("Calendar initialized:", calendar);

        document.getElementById("toggleView").addEventListener("click", function () {
            document.getElementById("calendar").classList.toggle("hidden");
            document.getElementById("listView").classList.toggle("hidden");
        });
    });
</script>
